<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>代码沙盒</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #1e1e1e;
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: #2d2d30;
            border-radius: 8px;
            border: 1px solid #3e3e42;
        }
        
        .header h1 {
            font-size: 28px;
            color: #cccccc;
            margin: 0 0 10px 0;
        }
        
        .subtitle {
            color: #999;
            font-size: 16px;
            margin: 0;
        }
        
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .editor-area {
            width: 100%;
            height: 100%;
            background: #1e1e1e;
            color: #fff;
            border: 1px solid #3e3e42;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: none;
            outline: none;
            line-height: 1.6;
            box-sizing: border-box;
        }
        
        .editor-area::placeholder {
            color: #666;
            line-height: 1.6;
        }
        
        .editor-area:focus {
            border-color: #007acc;
            box-shadow: 0 0 0 2px rgba(0, 122, 204, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>代码沙盒</h1>
            <div class="subtitle">粘贴完整的HTML代码，自动分离并预览</div>
        </div>
        
        <div class="editor-container">
            <textarea id="html-code" class="editor-area" placeholder="在这里粘贴完整的HTML代码（包含CSS和JavaScript）...

示例：
<!DOCTYPE html>
<html>
<head>
    <style>
        body { background: #f0f0f0; }
        .container { text-align: center; padding: 50px; }
    </style>
</head>
<body>
    <div class='container'>
        <h1>Hello World!</h1>
        <button onclick='alert(\"Hello!\")'>点击我</button>
    </div>
    <script>
        console.log('页面加载完成');
    </script>
</body>
</html>"></textarea>
        </div>
        
        <!-- 隐藏的CSS和JS编辑器，用于自动分离功能 -->
        <textarea id="css-code" style="display: none;"></textarea>
        <textarea id="js-code" style="display: none;"></textarea>
    </div>

    <script>
        function setDefaultCode() {
            var htmlCode = document.getElementById('html-code');
            // 清空默认内容，让用户看到placeholder
            htmlCode.value = '';
        }

        function openPreviewWindow() {
            var htmlContent = document.getElementById('html-code').value;
            
            if (!htmlContent.trim()) {
                showAutoProcessNotification('HTML编辑器中没有内容可以预览！');
                return;
            }
            
            // 检查是否是完整的HTML文档
            var isCompleteHTML = /<!DOCTYPE\s+html/i.test(htmlContent) && 
                                /<html[^>]*>/i.test(htmlContent) && 
                                /<\/html>/i.test(htmlContent);
            
            var fullHTML;
            if (isCompleteHTML) {
                // 如果是完整的HTML文档，直接使用
                fullHTML = htmlContent;
            } else {
                // 如果不是完整文档，包装成完整的HTML
                fullHTML = '<!DOCTYPE html>\n<html>\n<head>\n<meta charset="UTF-8">\n<title>Preview</title>\n</head>\n<body>\n' + htmlContent + '\n</body>\n</html>';
            }
            
            // 创建新窗口
            var previewWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
            
            if (previewWindow) {
                previewWindow.document.open();
                previewWindow.document.write(fullHTML);
                previewWindow.document.close();
                previewWindow.focus();
            } else {
                alert('无法打开新窗口，请检查浏览器的弹窗拦截设置。');
            }
        }

         
         function autoSeparateAndPreview() {
             var htmlContent = document.getElementById('html-code').value;
             
             if (!htmlContent.trim()) {
                 return;
             }
             
             // 直接在新窗口预览HTML代码
             openPreviewWindow();
             showAutoProcessNotification('检测到HTML代码，已在新窗口预览！');
             
             // 隐藏提示
             var hintElement = document.getElementById('auto-detect-hint');
             if (hintElement) {
                 hintElement.classList.remove('show');
             }
         }
         
         function separateCodeSilently() {
             var htmlContent = document.getElementById('html-code').value;
             
             if (!htmlContent.trim()) {
                 return;
             }
             
             // 提取CSS
             var cssMatches = htmlContent.match(/<style[^>]*>([\s\S]*?)<\/style>/gi);
             var extractedCSS = '';
             if (cssMatches) {
                 for (var i = 0; i < cssMatches.length; i++) {
                     var cssContent = cssMatches[i].replace(/<\/?style[^>]*>/gi, '');
                     extractedCSS += cssContent + '\n';
                 }
             }
             
             // 提取JavaScript
             var jsMatches = htmlContent.match(/<script[^>]*>([\s\S]*?)<\/script>/gi);
             var extractedJS = '';
             if (jsMatches) {
                 for (var i = 0; i < jsMatches.length; i++) {
                     var jsContent = jsMatches[i].replace(/<\/?script[^>]*>/gi, '');
                     extractedJS += jsContent + '\n';
                 }
             }
             
             // 移除HTML中的style和script标签
             var cleanHTML = htmlContent.replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '');
             cleanHTML = cleanHTML.replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '');
             
             // 更新编辑器内容
             document.getElementById('html-code').value = cleanHTML.trim();
             
             if (extractedCSS.trim()) {
                 document.getElementById('css-code').value = extractedCSS.trim();
             }
             
             if (extractedJS.trim()) {
                 document.getElementById('js-code').value = extractedJS.trim();
             }
             
             // 隐藏自动检测提示
             document.getElementById('auto-detect-hint').classList.remove('show');
         }
         
         function showAutoProcessNotification(message) {
             // 创建通知元素
             var notification = document.createElement('div');
             notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #4CAF50; color: white; padding: 15px 20px; border-radius: 5px; z-index: 1000; font-size: 14px; box-shadow: 0 2px 10px rgba(0,0,0,0.2);';
             notification.textContent = message;
             
             document.body.appendChild(notification);
             
             // 3秒后自动移除
             setTimeout(function() {
                 if (notification.parentNode) {
                     notification.parentNode.removeChild(notification);
                 }
             }, 3000);
         }
         
         function detectInlineCode() {
             var htmlContent = document.getElementById('html-code').value;
             var autoDetectHint = document.getElementById('auto-detect-hint');
             
             // 检测是否包含内联CSS或JavaScript
             var hasInlineCSS = /<style[^>]*>[\s\S]*?<\/style>/i.test(htmlContent);
             var hasInlineJS = /<script[^>]*>[\s\S]*?<\/script>/i.test(htmlContent);
             
             // 检测是否是完整的HTML文档（包含DOCTYPE、html、head、body等标签）
             var isCompleteHTML = /<!DOCTYPE\s+html/i.test(htmlContent) || 
                                 (/<html[^>]*>/i.test(htmlContent) && /<\/html>/i.test(htmlContent)) ||
                                 (/<head[^>]*>/i.test(htmlContent) && /<\/head>/i.test(htmlContent)) ||
                                 (/<body[^>]*>/i.test(htmlContent) && /<\/body>/i.test(htmlContent));
             
             if ((hasInlineCSS || hasInlineJS) && htmlContent.trim()) {
                 // 如果检测到完整的HTML文档结构，自动执行分离和预览
                 if (isCompleteHTML) {
                     // 延迟执行，确保用户完成粘贴操作
                     setTimeout(function() {
                         autoSeparateAndPreview();
                     }, 500);
                 } else {
                     // 只是显示提示
                     autoDetectHint.classList.add('show');
                 }
             } else {
                 autoDetectHint.classList.remove('show');
             }
         }
         
         // 监听HTML编辑器内容变化
         function setupAutoDetection() {
             var htmlEditor = document.getElementById('html-code');
             
             // 监听输入事件
             htmlEditor.addEventListener('input', function() {
                 detectInlineCode();
             });
             
             // 监听粘贴事件
             htmlEditor.addEventListener('paste', function(e) {
                 // 获取粘贴的内容
                 var pastedData = '';
                 if (e.clipboardData && e.clipboardData.getData) {
                     pastedData = e.clipboardData.getData('text/plain');
                 }
                 
                 // 检查粘贴的内容是否是完整的HTML文档
                 var isCompleteHTML = /<!DOCTYPE\s+html/i.test(pastedData) || 
                                     (/<html[^>]*>/i.test(pastedData) && /<\/html>/i.test(pastedData)) ||
                                     (/<head[^>]*>/i.test(pastedData) && /<\/head>/i.test(pastedData)) ||
                                     (/<body[^>]*>/i.test(pastedData) && /<\/body>/i.test(pastedData));
                 
                 var hasInlineCSS = /<style[^>]*>[\s\S]*?<\/style>/i.test(pastedData);
                 var hasInlineJS = /<script[^>]*>[\s\S]*?<\/script>/i.test(pastedData);
                 
                 if (isCompleteHTML && (hasInlineCSS || hasInlineJS)) {
                     // 如果粘贴的是完整HTML文档，延迟执行自动处理
                     setTimeout(function() {
                         autoSeparateAndPreview();
                     }, 300);
                 } else {
                     // 普通粘贴，执行常规检测
                     setTimeout(function() {
                         detectInlineCode();
                     }, 100);
                 }
             });
         }
 
         window.addEventListener('load', function() {
             setDefaultCode();
             setupAutoDetection();
         });
    </script>
</body>
</html>