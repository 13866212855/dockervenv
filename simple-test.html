<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Simple Test</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .container { display: flex; height: 500px; }
        .left { width: 50%; border: 1px solid #ccc; padding: 10px; }
        .right { width: 50%; border: 1px solid #ccc; margin-left: 10px; }
        textarea { width: 100%; height: 200px; }
        button { padding: 10px; margin: 5px; }
        iframe { width: 100%; height: 400px; border: none; }
    </style>
</head>
<body>
    <h1>代码分离测试</h1>
    <div class="container">
        <div class="left">
            <h3>完整HTML代码</h3>
            <textarea id="fullCode" placeholder="在这里粘贴完整的HTML代码..."></textarea>
            <br>
            <button onclick="separateCode()">分离代码</button>
            <button onclick="runCode()">运行预览</button>
            
            <h3>分离后的HTML</h3>
            <textarea id="htmlCode"></textarea>
            
            <h3>分离后的CSS</h3>
            <textarea id="cssCode"></textarea>
            
            <h3>分离后的JavaScript</h3>
            <textarea id="jsCode"></textarea>
        </div>
        <div class="right">
            <h3>预览结果</h3>
            <iframe id="preview"></iframe>
        </div>
    </div>

    <script>
        function separateCode() {
            var fullCode = document.getElementById('fullCode').value;
            
            if (!fullCode.trim()) {
                alert('请先输入完整的HTML代码');
                return;
            }
            
            var result = parseHTML(fullCode);
            
            document.getElementById('htmlCode').value = result.html;
            document.getElementById('cssCode').value = result.css;
            document.getElementById('jsCode').value = result.js;
            
            alert('代码分离完成！');
        }
        
        function parseHTML(htmlContent) {
            var result = { html: '', css: '', js: '' };
            
            // 提取CSS
            var styleMatches = htmlContent.match(/<style[^>]*>([\s\S]*?)<\/style>/gi);
            if (styleMatches) {
                var cssArray = [];
                for (var i = 0; i < styleMatches.length; i++) {
                    var cssContent = styleMatches[i].replace(/<\/?style[^>]*>/gi, '').trim();
                    if (cssContent) cssArray.push(cssContent);
                }
                result.css = cssArray.join('\n\n');
            }
            
            // 提取JavaScript
            var scriptMatches = htmlContent.match(/<script[^>]*>([\s\S]*?)<\/script>/gi);
            if (scriptMatches) {
                var jsArray = [];
                for (var i = 0; i < scriptMatches.length; i++) {
                    if (!scriptMatches[i].includes('src=')) {
                        var jsContent = scriptMatches[i].replace(/<\/?script[^>]*>/gi, '').trim();
                        if (jsContent) jsArray.push(jsContent);
                    }
                }
                result.js = jsArray.join('\n\n');
            }
            
            // 清理HTML
            var cleanHTML = htmlContent
                .replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '')
                .replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '')
                .replace(/^\s*\n/gm, '')
                .trim();
            
            result.html = cleanHTML;
            return result;
        }
        
        function runCode() {
            var html = document.getElementById('htmlCode').value;
            var css = document.getElementById('cssCode').value;
            var js = document.getElementById('jsCode').value;
            
            var fullHTML = buildHTML(html, css, js);
            
            var iframe = document.getElementById('preview');
            var doc = iframe.contentDocument || iframe.contentWindow.document;
            doc.open();
            doc.write(fullHTML);
            doc.close();
        }
        
        function buildHTML(html, css, js) {
            var result = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Preview</title>';
            
            if (css) {
                result += '<style>' + css + '</style>';
            }
            
            result += '</head><body>';
            
            if (html) {
                result += html;
            }
            
            if (js) {
                result += '<script>' + js + '</script>';
            }
            
            result += '</body></html>';
            return result;
        }
        
        // 设置示例代码
        document.getElementById('fullCode').value = 
            '<!DOCTYPE html>\n' +
            '<html>\n' +
            '<head>\n' +
            '    <title>Test</title>\n' +
            '    <style>\n' +
            '        body { text-align: center; padding: 50px; }\n' +
            '        h1 { color: blue; }\n' +
            '        button { padding: 10px 20px; background: green; color: white; border: none; }\n' +
            '    </style>\n' +
            '</head>\n' +
            '<body>\n' +
            '    <h1>Hello World!</h1>\n' +
            '    <p>这是一个测试页面</p>\n' +
            '    <button onclick="changeColor()">点击改变颜色</button>\n' +
            '    <script>\n' +
            '        function changeColor() {\n' +
            '            var colors = ["red", "blue", "green", "purple", "orange"];\n' +
            '            var randomColor = colors[Math.floor(Math.random() * colors.length)];\n' +
            '            document.querySelector("h1").style.color = randomColor;\n' +
            '        }\n' +
            '    </script>\n' +
            '</body>\n' +
            '</html>';
    </script>
</body>
</html>